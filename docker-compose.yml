# Web development environment
version: '2.1'
services:
  # To create email during devloppement
  maildev:
      container_name: maildev
      image: djfarrelly/maildev
      ports:
        - ${MAILDEV_PORT}:80
        - 1025:25

  # # Doc : apigen
  # apigen:
  #   build: docker/apigen
  #   image: vfalies/apigen
  #   container_name: apigen

  # # Deployer
  # deployer:
  #   build: docker/deployer
  #   image: vfalies/deployer
  #   container_name: deployer

  # NodeJS
  nodejs:
    image: node
    container_name: node

  # Web Server NGinx
  web:
    image: nginx
    ports:
        - ${WEB_PORT}:80
    container_name: web
    volumes:
        - ./conf/nginx/vhosts:/etc/nginx/conf.d
        - ./conf/nginx/nginx.conf:/etc/nginx/nginx.conf
        - ${PROJECTS_PATH}:/var/www/html
    links:
        - php:php

  # PHP FPM
  php:
    image: vfac/envdevphpbase:${PHP_VERSION}
    container_name: php
    volumes:
        - ${PROJECTS_PATH}:/var/www/html
        - ./conf/php/php.ini:/usr/local/etc/php/php.ini
    links:
        - db:db
        - maildev:maildev

  # Database
  db:
    extends: 
        file: services/${DB}.yml
        service: db
  
  # Database admin
  dbadmin:
    extends:
        file: services/${DB}.yml
        service: dbadmin
    ports:
        - ${DBADMIN_PORT}:80
    links:
        - db
        
volumes: 
  dbdata_mariadb:
    labels: 
        com.vfac.description: "VFAC EnvDev Database MariaDB volume"
        com.vfac.owner: "VFAC"
        com.vfac.url: "https://vfac.fr"
  dbdata_mysql:
    labels: 
        com.vfac.description: "VFAC EnvDev Database MySQL volume"
        com.vfac.owner: "VFAC"
        com.vfac.url: "https://vfac.fr"        
  dbdata_mongodb:
    labels: 
        com.vfac.description: "VFAC EnvDev Database MongoDB volume"
        com.vfac.owner: "VFAC"
        com.vfac.url: "https://vfac.fr"        